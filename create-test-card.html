<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Test Card</title>
    <script src="https://unpkg.com/dexie@3.2.4/dist/dexie.js"></script>
    <script src="js/database-dexie.js"></script>
    <script src="js/scheduler.js"></script>
</head>
<body>
    <h1>Create Test Card for Review</h1>
    <button id="createTestCard">Create Test Card Due Today</button>
    <div id="status"></div>

    <script>
        document.getElementById('createTestCard').addEventListener('click', async () => {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = 'Creating test card...';

            try {
                // Wait for database to be ready
                await new Promise(resolve => {
                    if (window.MimirDB) {
                        resolve();
                    } else {
                        document.addEventListener('DOMContentLoaded', resolve);
                    }
                });

                // Create a test card that's due today
                const today = new Date();
                today.setUTCHours(0, 0, 0, 0); // Start of day in UTC

                const testCard = {
                    card_id: 'test-card-' + Date.now(),
                    prompt: 'What is the capital of France?',
                    response: 'Paris',
                    tags: ['geography', 'test'],
                    created_at: new Date().toISOString(),
                    updated_at: new Date().toISOString(),
                    due_date: today.toISOString(), // Due today at start of day
                    review_interval: 0,
                    review_count: 0,
                    last_reviewed: null
                };

                console.log('Creating test card:', testCard);
                await MimirDB.saveCard(testCard);

                statusDiv.innerHTML = `
                    <p style="color: green;">✅ Test card created successfully!</p>
                    <p>Card ID: ${testCard.card_id}</p>
                    <p>Due date: ${new Date(testCard.due_date).toLocaleString()}</p>
                    <p><a href="review.html">Go to Review Page</a></p>
                `;

            } catch (error) {
                console.error('Failed to create test card:', error);
                statusDiv.innerHTML = `<p style="color: red;">❌ Failed to create test card: ${error.message}</p>`;
            }
        });
    </script>
</body>
</html>
